<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true) die();?>
<div class="form inline<?=($arResult['FORM_NOTE'] ? ' success' : '')?><?=($arResult['isFormErrors'] == 'Y' ? ' error' : '')?>  border_block <?=$templateName;?>">
	<div class="top-form">
		<?if(strlen($arResult["FORM_NOTE"])){?>
			<!--noindex-->
			<?if($arResult["isFormTitle"] == "Y"):?>
				<div class="form-header-text">
					<div class="text">
						<div class="title"><?=($arResult['FORM_NOTE'] ? GetMessage("SUCCESS_TITLE") : $arResult["FORM_TITLE"]);?></div>
						<div class="text_msg">
							<?$successNoteFile = SITE_DIR."include/form/success_{$arResult["arForm"]["SID"]}.php";?>
							<?if(\Bitrix\Main\IO\File::isFileExists(\Bitrix\Main\Application::getDocumentRoot().$successNoteFile)):?>
								<?$APPLICATION->IncludeFile($successNoteFile, array(), array("MODE" => "html", "NAME" => "Form success note"));?>
							<?elseif($arParams["SUCCESS_MESSAGE"]):?>
								<div class="description">
									<svg class="success_icon" xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 90 90">
									  <path id="Ellipse_273_copy" data-name="Ellipse 273 copy" class="clsp-1" d="M1550,151a45,45,0,1,1-45,45A45,45,0,0,1,1550,151Zm0,2a43,43,0,1,1-43,43A43,43,0,0,1,1550,153Z" transform="translate(-1505 -151)"/>
									  <path class="clsp-2" d="M1539.82,207.4a4.45,4.45,0,0,0,2.9,1.609c0.9,0.014,1.66-.434,2.93-1.854,1.53-1.692,23.35-24.3,23.35-24.3l-1-.852h-2l-2,2-20,21-10-10h-2l-2,1v2l2,4,4.9,3.372Z" transform="translate(-1505 -151)"/>
									  <path id="Rounded_Rectangle_840_copy_2" data-name="Rounded Rectangle 840 copy 2" class="clsp-1" d="M1545.41,212.678a4.006,4.006,0,0,1-4.33-.877h0l-10.91-10.88a4,4,0,0,1,5.66-5.646l8.08,8.057,20.23-21.172a4,4,0,0,1,5.66,5.646L1546.74,211.8A3.924,3.924,0,0,1,1545.41,212.678Zm22.97-26.283a2,2,0,1,0-2.83-2.823l-20.23,21.172-1.41,1.411-1.42-1.411-8.07-8.057a2,2,0,0,0-2.83,0,1.976,1.976,0,0,0,0,2.822l8.45,8.438,2.45,2.443a2.05,2.05,0,0,0,.66.438,2.005,2.005,0,0,0,2.17-.438l2.44-2.432Z" transform="translate(-1505 -151)"/>
									</svg>
									<div class="success-text"><?=htmlspecialchars_decode(htmlspecialchars_decode(htmlspecialchars_decode($arParams["SUCCESS_MESSAGE"])));?></div>
								</div>
							<?else:?>
								<div class="description">
									<svg class="success_icon" xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80">
									  <path class="clsp-1" d="M1550,156a40,40,0,1,1-40,40A40,40,0,0,1,1550,156Zm0,2a38,38,0,1,1-38,38A38,38,0,0,1,1550,158Z" transform="translate(-1510 -156)"/>
									  <path id="Ellipse_273_copy_2" data-name="Ellipse 273 copy 2" class="clsp-1" d="M1580.74,210.529l-0.03-.017a0.969,0.969,0,0,1-.84.488,1,1,0,0,1-1-1,1.018,1.018,0,0,1,.15-0.488l-0.01,0A31.934,31.934,0,0,0,1582,196a1,1,0,0,1,2,0A33.8,33.8,0,0,1,1580.74,210.529ZM1550,230a33.825,33.825,0,0,1-15.33-3.661,1.1,1.1,0,0,1-.14-0.066s-0.01,0-.01,0h0a0.99,0.99,0,0,1,.48-1.862,0.944,0.944,0,0,1,.48.141l0.02-.025a31.973,31.973,0,0,0,40.69-10.152l0.03,0.023a0.993,0.993,0,1,1,1.46,1.334A33.953,33.953,0,0,1,1550,230Zm9-64.75a1.043,1.043,0,0,1-.26-0.052v0.02a31.967,31.967,0,0,0-29.55,6.483l-0.02-.026a0.995,0.995,0,0,1-1.73-.675,0.986,0.986,0,0,1,.46-0.822,33.953,33.953,0,0,1,31.41-6.877v0.011a0.986,0.986,0,0,1,.69.938A1,1,0,0,1,1559,165.25ZM1525.43,175.5a32.077,32.077,0,0,0-5.59,9.807l-0.02-.009a1,1,0,0,1-1.95-.3,1.047,1.047,0,0,1,.11-0.434v0a33.786,33.786,0,0,1,5.78-10.183l0.01,0.008a0.976,0.976,0,0,1,.79-0.42,1,1,0,0,1,1,1,0.906,0.906,0,0,1-.16.509Z" transform="translate(-1510 -156)"/>
									  <path class="clsp-2" d="M1533,194h2l3,3,6,6,16-17,4-4h2l3,2v2l-2,2-21,21-2,1-2-1-6-6-5-5v-3Z" transform="translate(-1510 -156)"/>
									  <path id="Rounded_Rectangle_840_copy_2" data-name="Rounded Rectangle 840 copy 2" class="clsp-1" d="M1545.41,210.678a4.075,4.075,0,0,1-.74.22,4,4,0,0,1-3.59-1.1h0l-9.91-9.88a4,4,0,0,1,5.66-5.646l7.08,7.057,19.23-19.172a4,4,0,0,1,5.66,5.646L1546.74,209.8A3.924,3.924,0,0,1,1545.41,210.678Zm21.97-24.283a2,2,0,1,0-2.83-2.823l-19.23,19.172-1.41,1.411-1.42-1.411-7.07-7.057a2,2,0,0,0-2.83,0,1.976,1.976,0,0,0,0,2.822l7.45,7.438,2.45,2.443a2.05,2.05,0,0,0,.66.438,2.005,2.005,0,0,0,2.17-.438l2.44-2.432Z" transform="translate(-1510 -156)"/>
									</svg>
									<div class="success-text"><?=GetMessage("FORM_SUCCESS");?></div>
								</div>
							<?endif;?>
						</div>
					</div>
				</div>
			<?endif;?>

			<div class="form_result <?=($arResult["isFormErrors"] == "Y" ? 'error' : 'success')?>">
				<?if($arResult["isFormErrors"] == "Y"):?>
					<?=$arResult["FORM_ERRORS_TEXT"]?>
				<?else:?>
					<script>
						if(arPriorityOptions['THEME']['USE_FORMS_GOALS'] !== 'NONE')
						{
							var id = '_'+'<?=((isset($arResult["arForm"]["ID"]) && $arResult["arForm"]["ID"]) ? $arResult["arForm"]["ID"] : $arResult["ID"] )?>';
							var eventdata = {goal: 'goal_webform_success' + (arPriorityOptions['THEME']['USE_FORMS_GOALS'] === 'COMMON' ? '' : id)};
							BX.onCustomEvent('onCounterGoals', [eventdata]);
						}
					</script>
					<?if( $arParams["DISPLAY_CLOSE_BUTTON"] ){?>
						<div class="form-footer" style="text-align: left;">
							<button class="btn-lg <?=$arParams["CLOSE_BUTTON_CLASS"];?>"><?=($arParams["CLOSE_BUTTON_NAME"] ? $arParams["CLOSE_BUTTON_NAME"] : GetMessage("RELOAD_PAGE"));?></button>
						</div>
					<?}?>
				<?endif;?>
			</div>
		<?}?>
		<?if(!$arResult["FORM_NOTE"]){?>
			<?=$arResult["FORM_HEADER"]?>
				<?=bitrix_sessid_post();?>
				<div class="form-header-text">
					<div class="text">
						<?if($arResult["isFormDescription"] == "Y"):?>
							<div class=""><?=$arResult["FORM_DESCRIPTION"]?></div>
						<?endif;?>
					</div>
				</div>
				<?if($arResult["isFormErrors"] == "Y"):?>
					<div class="form-error alert alert-danger"><?=$arResult["FORM_ERRORS_TEXT"]?></div>
				<?endif;?>
				<div class="form-body">
					<?if(is_array($arResult["QUESTIONS"])):?>
						<?foreach($arResult["QUESTIONS"] as $FIELD_SID => $arQuestion):?>
							<?CPriority::drawFormField($FIELD_SID, $arQuestion, "INLINE_".$arResult["arForm"]["ID"]);?>
						<?endforeach;?>
					<?endif;?>
					<?if($arResult["isUseCaptcha"] == "Y"):?>
						<div class="form-control captcha-row clearfix">
							<label><span><?=GetMessage("FORM_CAPRCHE_TITLE")?>&nbsp;<span class="star">*</span></span></label>
							<div class="captcha_image">
								<img src="/bitrix/tools/captcha.php?captcha_sid=<?=htmlspecialcharsbx($arResult["CAPTCHACode"])?>" border="0" />
								<input type="hidden" name="captcha_sid" value="<?=htmlspecialcharsbx($arResult["CAPTCHACode"])?>" />
								<div class="captcha_reload"></div>
							</div>
							<div class="captcha_input">
								<input type="text" class="inputtext captcha" name="captcha_word" size="30" maxlength="50" value="" required />
							</div>
						</div>
					<?elseif($arParams["HIDDEN_CAPTCHA"] == "Y"):?>
						<textarea name="nspm" style="display:none;"></textarea>
					<?endif;?>
				</div>
				<div class="form-footer">
					<?if($arParams["SHOW_LICENCE"] == "Y"):?>
						<div class="licence_block bx_filter">
							<input type="checkbox" id="licenses_inline_<?=$arResult["arForm"]["ID"]?>" <?=(COption::GetOptionString("aspro.priority", "LICENCE_CHECKED", "N") == "Y" ? "checked" : "");?> name="licenses_popup" required value="Y">
							<label for="licenses_inline_<?=$arResult["arForm"]["ID"]?>">
								<?$APPLICATION->IncludeFile(SITE_DIR."include/licenses_text.php", Array(), Array("MODE" => "html", "NAME" => "LICENSES")); ?>
							</label>
						</div>
					<?endif;?>
					<div class="text-left">
						<input type="submit" class="btn btn-default btn-lg" value="<?=$arResult["arForm"]["BUTTON"]?>" name="web_form_submit">
					</div>
				</div>
			<?=$arResult["FORM_FOOTER"]?>
		<?}?>
		<!--/noindex-->
		<script type="text/javascript">
		var bFormNote = <?=CUtil::PhpToJSObject($arResult['FORM_NOTE']);?>;
		$(document).ready(function(){
			$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"]').validate({
				highlight: function( element ){
					$(element).parent().addClass('error');
				},
				unhighlight: function( element ){
					$(element).parent().removeClass('error');
				},
				submitHandler: function( form ){
					if( $('form[name="<?=$arResult["arForm"]["VARNAME"]?>"]').valid() ){
						setTimeout(function() {
							$(form).find('button[type="submit"]').attr("disabled", "disabled");
						}, 300);
						var eventdata = {type: 'form_submit', form: form, form_name: '<?=$arResult["arForm"]["VARNAME"]?>'};
						BX.onCustomEvent('onSubmitForm', [eventdata]);
						if(!bFormNote){
							$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"]').prepend('<div class="overlay_form"><div class="loader"><div class="duo duo1"><div class="dot dot-a"></div><div class="dot dot-b"></div></div><div class="duo duo2"><div class="dot dot-a"></div><div class="dot dot-b"></div></div></div></div>');
						}
					}
				},
				errorPlacement: function( error, element ){
					if($(element).hasClass('captcha')){
						$(element).closest('.captcha-row').append(error);
					}
					else if($(element).closest('.licence_block').length){
						$(element).closest('.licence_block').append(error);
					}
					else if($(element).closest('[data-sid=FILE]')){
						$(element).closest('.form-group').append(error);
					}
					else{
						if($(element).closest('.licence_block').length){
							$(element).closest('.licence_block').append(error);
						}
						else if($(element).closest('[data-sid=FILE]')){
							$(element).closest('.form-group').append(error);
						}
						else{
							error.insertAfter(element);
						}
					}
				},
				messages:{
			      licenses_popup: {
			        required : BX.message('JS_REQUIRED_LICENSES')
			      }
				}
			});

			$('[name=licenses_popup]').onoff();

			if(arPriorityOptions['THEME']['PHONE_MASK'].length){
				var base_mask = arPriorityOptions['THEME']['PHONE_MASK'].replace( /(\d)/g, '_' );
				$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"] input.phone').inputmask('mask', {'mask': arPriorityOptions['THEME']['PHONE_MASK'], 'showMaskOnHover': false });
				$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"] input.phone').blur(function(){
					if( $(this).val() == base_mask || $(this).val() == '' ){
						if( $(this).hasClass('required') ){
							$(this).parent().find('div.error').html(BX.message('JS_REQUIRED'));
						}
					}
				});
			}

			if(arPriorityOptions['THEME']['DATE_MASK'].length){
				$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"] input.date').inputmask('datetime', {
					inputFormat: arPriorityOptions['THEME']['DATE_MASK'],
					placeholder: arPriorityOptions['THEME']['DATE_PLACEHOLDER'],
					showMaskOnHover: false
				});
			}

			if(arPriorityOptions['THEME']['DATETIME_MASK'].length){
				$('form[name="<?=$arResult["arForm"]["VARNAME"]?>"] input.datetime').inputmask('datetime', {
					inputFormat: arPriorityOptions['THEME']['DATETIME_MASK'],
					placeholder: arPriorityOptions['THEME']['DATETIME_PLACEHOLDER'],
					showMaskOnHover: false
				});
			}

			$('.jqmClose').on('click', function(e){
				e.preventDefault();
				$(this).closest('.jqmWindow').jqmHide();
			});

			if($('#licenses_popup').length){
				$('#licenses_popup').onoff();
			}

			$('input[type=file]').uniform({fileButtonHtml: BX.message('JS_FILE_BUTTON_NAME'), fileDefaultHtml: BX.message('JS_FILE_DEFAULT')});
			$(document).on('change', 'input[type=file]', function(){
				if($(this).val())
				{
					$(this).closest('.uploader').addClass('files_add');
				}
				else
				{
					$(this).closest('.uploader').removeClass('files_add');
				}
			})
			$('.form .add_file').on('click', function(){
				var index = $(this).closest('.input').find('input[type=file]').length+1;
				$('<input type="file" id="POPUP_FILE" name="FILE_n'+index+'"   class="inputfile" value="" />').insertBefore($(this));
				$('input[type=file]').uniform({fileButtonHtml: BX.message('JS_FILE_BUTTON_NAME'), fileDefaultHtml: BX.message('JS_FILE_DEFAULT')});
			})
		});
		</script>
	</div>
</div>